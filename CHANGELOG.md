# 更新日志

本项目的所有重要更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.5.0] - 2025-02-28

### 新增
- **文章浏览权限** - 支持三种可见性设置
  - 所有人可见（默认）
  - 仅作者可见
  - 密码保护（需输入访问密码）
- **数据库迁移功能** - `/migrate-db` 路由用于添加新列
- **自动迁移检测** - `init-db` 自动检测并添加缺失的列
- **密码验证页面** - `post_password.html` 模板

### 优化
- **向后兼容** - 数据库迁移自动检测，不影响现有数据
- **用户体验** - 密码保护文章使用会话存储，无需重复输入
- **代码结构** - 可见性检查逻辑集中在文章查看路由

### 修复
- **500 错误** - 修复因缺少新列导致的数据库错误
- **会话管理** - 密码验证后正确存储会话状态

## [1.4.0] - 2025-02-28

### 修复
- **图片上传嵌套语法** - 修复 `![alt](![alt](url))` 嵌套问题
  - 重写 `uploadAndReplaceLocalPath` 函数
  - 重写 `uploadLocalImage` 函数
  - 修复 `insertContentImage` 函数的检测逻辑
- **JavaScript 错误** - 修复 `.stripQuotes()` 方法不存在
- **正则表达式语法** - 修复 `isLocalImagePath` 函数
- **escapeHtml 引用错误** - 修复函数定义位置问题

### 优化
- **代码质量** - 移除批量上传功能，简化代码
- **错误处理** - 改进图片上传的错误提示
- **安全性** - 移除硬编码生产环境密钥回退值，要求必须设置 SECRET_KEY

### 移除
- **批量上传功能** - 由于持续报错且复杂度较高，暂时移除

## [1.3.0] - 2025-02-28

### 新增
- **GitHub 图床支持** - 免费图床，图片永久保存，无需信用卡
- **存储后端抽象** - `app/utils/storage.py` 支持本地和 GitHub 存储
- **自动存储选择** - 根据环境变量自动选择存储后端
- **默认 OG 图片** - `app/static/img/default-og.png` 用于社交媒体分享
- **完整配置文档** - `docs/GITHUB_STORAGE.md` GitHub 图床配置指南

### 优化
- **图片上传流程** - 统一封面图和内容图片上传
- **环境变量管理** - 支持灵活的存储配置
- **错误处理** - 更好的错误提示和日志记录

### 修复
- **generate-summary API 400 错误** - 添加 CSRF token
- **图片显示后消失** - 修复懒加载缓存问题
- **Flask 上下文错误** - 使用标准 logging 模块
- **封面图类型识别** - 正确识别 GitHub URL

## [1.2.0] - 2025-02-27

### 新增
- **字体优化功能** - 支持楷体/宋体，跨平台字体检测
- **重新生成封面图** - 批量重新生成文章封面
- **快捷插入图片** - 编辑器内 Ctrl+I 快捷键
- **本地图片智能提示** - 自动检测本地路径并提示上传
- **图片查看功能** - 点击图片查看大图
- **图片懒加载** - 优化页面加载性能
- **MD 导入增强** - 批量上传，自动路径匹配

### 优化
- **封面图生成器** - 支持更多字体和智能字体大小
- **编辑器体验** - 更好的用户交互反馈

### 修复
- **编辑页面 JavaScript 语法错误** - 修复额外的大括号

## [1.1.0] - 2025-01-18

### 新增
- **Markdown 文件批量导入**
- **自动生成文章摘要**
- **图片上传和优化**
- **定时发布功能**

### 优化
- **编辑器用户体验**
- **后台仪表板**

## [1.0.0] - 2025-01-10

### 新增
- 初始版本发布
- 完整的博客功能
- 用户认证和权限管理
- 文章 CRUD 操作
- 分类和标签系统
- Markdown 写作支持
- 响应式设计
- 夜间模式
- 智能搜索
- RSS 订阅
- Sitemap 生成

---

## 版本说明

- **新增** - 新功能
- **优化** - 现有功能的改进
- **修复** - 问题修复
- **安全** - 安全相关的修复
- **移除** - 功能移除

## 链接

- [GitHub 仓库](https://github.com/linxiong-rgb/flask-blog)
- [问题反馈](https://github.com/linxiong-rgb/flask-blog/issues)
